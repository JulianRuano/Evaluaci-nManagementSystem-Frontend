import{a as A,b as H,c as M,d as Y,e as C,f as R,p as n,u as v,j as e,M as P,F as $,g as D,h as t,E as y,S as L,L as Z,i as V,r as T,k as ee,l as se,s as ae,m as oe,n as re,o as S,q as le,t as W,_ as ie,Q as U}from"./index-f4f1ada5.js";async function ne(d){const c={withCredentials:!0};return(await A.post(`${H}/autoEvaluations/labour`,d,c)).data}const I=M().shape({isActive:Y().required("El estado es obligatorio"),nameWork:C().required("El nombre de la labor es obligatorio"),labourType:M().shape({idLabourType:R().integer().min(1).max(10),code:C(),description:C().notOneOf([""],"La descripción no puede estar vacía").required("La descripción es obligatoria")}),assignedHours:R().integer().min(2,"El número de horas asignadas no puede ser menor a 2").max(18,"El número de horas asignadas no puede ser mayor a 18").required("Las horas asignadas son obligatorias")}),B=({isModalOpen:d,handleOk:c,handleCancel:x,handleCreateLabourMutation:h,labourMutation:m,labourTypesLoading:j,labourTypesError:g})=>{const f=v(i=>i.labours.labourTypes);return j?e.jsx("div",{children:"Cargando"}):g?e.jsx("div",{children:"Error al cargar los tipos de labores"}):e.jsx(P,{open:d,onOk:c,onCancel:x,okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},width:800,centered:!0,children:e.jsx($,{initialValues:{nameWork:"",labourType:{idLabourType:"",code:"",description:"",labourTypeUid:""},assignedHours:"",isActive:""},validationSchema:I,onSubmit:h,children:({isSubmitting:i,setFieldValue:l})=>e.jsxs(D,{className:" space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"font-bold text-2xl text-stone-700",children:"Nueva labor"}),e.jsx("p",{children:"A continuacion ingrese los datos de la labor"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-xs font-semibold px-1",children:"Nombre de la labor"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(t,{type:"text",id:"nameWork",name:"nameWork",className:"w-full  pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",placeholder:"Labor"}),e.jsx(y,{className:"text-red-600 text-sm  py-1",name:"nameWork",component:"div"})]})]}),e.jsx(t,{type:"hidden",id:"labourTypeUid",name:"labourType.labourTypeUid"}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-xs font-semibold",children:"Horas asignadas"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(t,{type:"text",id:"assignedHours",name:"assignedHours",className:"w-full pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",placeholder:"2-18",onChange:r=>{const a=r.target.value;if(a==="")l("assignedHours",null);else{const o=parseInt(a,10);isNaN(o)||l("assignedHours",o)}}}),e.jsx(y,{className:"text-red-600 text-sm py-1 ",name:"assignedHours",component:"div"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"role",className:"text-xs font-semibold px-1",children:"Descripción"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(t,{as:"select",id:"labour",name:"labourType.description",className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",onChange:r=>{const a=r.target.value;if(a==="")l("labourType.description",""),l("labourType.code",""),l("labourType.labourTypeUid",""),l("labourType.idLabourType","");else{const o=f.find(u=>u.description===a);l("labourType.description",o.description),l("labourType.code",o.code),l("labourType.labourTypeUid",o.uid),l("labourType.idLabourType",o.idLabourType)}},children:[e.jsx("option",{value:"",children:"Elige una labor"}),f.map(r=>e.jsx("option",{value:r.description,children:r.description},r.idlabor))]}),e.jsx(y,{className:"text-red-600 text-sm py-1",name:"labourType.description",component:"div"})]})]}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"title",className:"text-xs font-semibold px-1",children:"Código"}),e.jsx("div",{className:"flex flex-col",children:e.jsx(t,{type:"text",id:"codigo",name:"labourType.code",disabled:!0,className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"})})]})]}),e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"id",className:"text-xs font-semibold px-1",children:"ID"}),e.jsx("div",{className:"flex flex-col",children:e.jsx(t,{type:"text",id:"idlabor",name:"labourType.idLabourType",disabled:!0,className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"})})]}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"idType",className:"text-xs font-semibold px-1",children:"Activa"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(t,{as:"select",id:"isActive",name:"isActive",className:"w-full  pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",onChange:r=>{const o=r.target.value==="true";l("isActive",o)},children:[e.jsx("option",{value:"",children:"Elige una opción"}),e.jsx("option",{value:"true",children:"Si"}),e.jsx("option",{value:"false",children:"No"})]}),e.jsx(y,{className:"text-red-600 text-sm pt-1",name:"isActive",component:"div"})]})]})]}),e.jsx("div",{className:"w-full mt-2",children:e.jsx("button",{type:"submit",disabled:m.isPending,className:`block w-full max-w-xs mx-auto  bg-indigo-500 hover:bg-indigo-700  text-white rounded-lg py-2  font-semibold ${m.isPending?"opacity-50":""}`,children:"Agregar"})})]})]})})})};B.propTypes={isModalOpen:n.bool.isRequired,handleOk:n.func.isRequired,handleCancel:n.func.isRequired,handleCreateLabourMutation:n.func.isRequired,labourMutation:n.object.isRequired,labourTypesLoading:n.bool.isRequired,labourTypesError:n.bool.isRequired};const Q=({isModalOpen:d,handleOk:c,handleCancel:x,handleUpdateLabourMutation:h,labourUpdateMutation:m,labourTypesLoading:j,labourTypesError:g})=>{const f=v(r=>r.labours.labourTypeUidToEdit),i=v(r=>r.labours.labours.find(a=>a.uid===f)),l=v(r=>r.labours.labourTypes);return j?e.jsx("div",{className:"px-5 py-5",children:Array.from({length:10}).map((r,a)=>e.jsxs("div",{children:[e.jsx(L,{active:!0}),e.jsx("br",{})]},a))}):g?e.jsx("p",{children:"Ha ocurrido un error"}):e.jsx(P,{open:d,onOk:c,onCancel:x,okButtonProps:{hidden:!0},cancelButtonProps:{hidden:!0},width:800,centered:!0,children:e.jsx($,{initialValues:{nameWork:i.nameWork,labourType:{idLabourType:i.labourType.idLabourType,code:i.labourType.code,description:i.labourType.description,labourTypeUid:i.labourType.uid},assignedHours:i.assignedHours,isActive:i.isActive},validationSchema:I,onSubmit:h,children:({isSubmitting:r,setFieldValue:a})=>e.jsxs(D,{className:" space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"font-bold text-2xl text-stone-700",children:"Actualizar labor"}),e.jsx("p",{children:"A continuacion ingrese los datos de la labor"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-xs font-semibold px-1",children:"Nombre de la labor"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(t,{type:"text",id:"nameWork",name:"nameWork",className:"w-full  pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",placeholder:"Labor"}),e.jsx(y,{className:"text-red-600 text-sm  py-1",name:"nameWork",component:"div"})]})]}),e.jsx(t,{type:"hidden",id:"labourTypeUid",name:"labourType.labourTypeUid"}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-xs font-semibold",children:"Horas asignadas"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx(t,{type:"text",id:"assignedHours",name:"assignedHours",disabled:!0,className:"w-full pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",placeholder:"35",onChange:o=>{const u=o.target.value;if(u==="")a("assignedHours",null);else{const p=parseInt(u,10);isNaN(p)||a("assignedHours",p)}}}),e.jsx(y,{className:"text-red-600 text-sm py-1 ",name:"assignedHours",component:"div"})]})]})]}),e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"role",className:"text-xs font-semibold px-1",children:"Descripción"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(t,{as:"select",id:"labour",name:"labourType.description",className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",onChange:o=>{const u=o.target.value;if(u==="")a("labourType.description",""),a("labourType.code",""),a("labourType.labourTypeUid",""),a("labourType.idLabourType","");else{const p=l.find(w=>w.description===u);a("labourType.description",p.description),a("labourType.code",p.code),a("labourType.labourTypeUid",p.uid),a("labourType.idLabourType",p.idLabourType)}},children:[e.jsx("option",{value:"",children:"Elige una labor"}),l.map(o=>e.jsx("option",{value:o.description,children:o.description},o.idlabor))]}),e.jsx(y,{className:"text-red-600 text-sm py-1",name:"labourType.description",component:"div"})]})]}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"title",className:"text-xs font-semibold px-1",children:"Código"}),e.jsx("div",{className:"flex flex-col",children:e.jsx(t,{type:"text",id:"codigo",name:"labourType.code",disabled:!0,className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"})})]})]}),e.jsxs("div",{className:"flex flex-wrap -mx-3",children:[e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"id",className:"text-xs font-semibold px-1",children:"ID"}),e.jsx("div",{className:"flex flex-col",children:e.jsx(t,{type:"text",id:"idlabor",name:"labourType.idLabourType",disabled:!0,className:"w-full pl-3 pr-3 py-0.5 rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500"})})]}),e.jsxs("div",{className:"sm:w-1/2 w-full px-3 mb-2",children:[e.jsx("label",{htmlFor:"idType",className:"text-xs font-semibold px-1",children:"Activa"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(t,{as:"select",id:"isActive",name:"isActive",className:"w-full  pl-3 pr-3 py-0.5  rounded-lg border-2 border-gray-200 outline-none focus:border-indigo-500",onChange:o=>{const u=o.target.value;u===""?a("isActive",""):a("isActive",u==="true")},children:[e.jsx("option",{value:"",children:"Elige una opción"}),e.jsx("option",{value:"true",children:"Si"}),e.jsx("option",{value:"false",children:"No"})]}),e.jsx(y,{className:"text-red-600 text-sm pt-1",name:"isActive",component:"div"})]})]})]}),e.jsxs("div",{className:"w-full gap-3 mt-2 flex",children:[e.jsx("button",{type:"reset",className:"block w-1/2 mx-auto  bg-red-400 hover:bg-red-500 text-white rounded-lg py-2  font-semibold ",onClick:()=>x(),children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:m.isPending,className:`block w-1/2 mx-auto  bg-indigo-500 hover:bg-indigo-700  text-white rounded-lg py-2  font-semibold ${m.isPending?"opacity-50":""}`,children:m.isPending?e.jsxs("p",{children:["Guardando ",e.jsx(Z,{})]}):"Guardar"})]})]})]})})})};Q.propTypes={isModalOpen:n.bool.isRequired,handleOk:n.func.isRequired,handleCancel:n.func.isRequired,labourId:n.string.isRequired,handleUpdateLabourMutation:n.func.isRequired,labourUpdateMutation:n.object.isRequired,labourTypesLoading:n.bool.isRequired,labourTypesError:n.bool.isRequired};async function te({values:d,id:c}){const x={withCredentials:!0};return console.log(d,c),(await A.put(`${H}/autoEvaluations/labour/${c}`,d,x)).data}async function de(){const d={withCredentials:!0};return(await A.get(`${H}/autoEvaluations/labourTypes`,d)).data}function ce(){return V({queryKey:["labourTypes"],queryFn:de})}const pe=()=>{const[d,c]=T.useState(!1),[x,h]=T.useState(!1),m=T.useRef({}),j=v(s=>s.labours.labourTypeUidToEdit),g=v(s=>s.labours.labours.find(b=>b.uid===j)),f=ee(),{data:i,isLoading:l,isError:r}=se();T.useEffect(()=>{i&&f(ae(i))},[i]);const{data:a,isLoading:o,isError:u}=ce();T.useEffect(()=>{a&&f(oe(a))},[a]);const p=re(),w=s=>U.success(s,{position:"bottom-right",autoClose:3e3,hideProgressBar:!0,pauseOnHover:!1}),k=s=>U.error(s,{position:"bottom-right",autoClose:3e3,hideProgressBar:!0,pauseOnHover:!1}),G=()=>{c(!0)},z=()=>{c(!1)},F=()=>{c(!1)},_=()=>{h(!1)},K=()=>{h(!1)},q=S({mutationFn:ne,onSuccess:s=>{console.log(s),p.invalidateQueries("labours"),w("Labor creada con éxito")},onError:async s=>{var b;if(((b=s==null?void 0:s.response)==null?void 0:b.status)===401){await f(W());return}console.log(s),k("Ocurrió un error al crear la labor")}}),J=(s,b)=>{const N={nameWork:s.nameWork,labourType:s.labourType.labourTypeUid,assignedHours:s.assignedHours,isActive:s.isActive},E=b;q.mutate(N,{onSuccess:()=>{E.resetForm({nameWork:"",labourType:{idLabourType:"",code:"",description:""},assignedHours:"",isActive:""})}})},O=S({mutationFn:te,onSuccess:s=>{console.log(s),p.invalidateQueries("labours"),w("Labor actualizada con éxito"),h(!1)},onError:async s=>{var b;if(((b=s==null?void 0:s.response)==null?void 0:b.status)===401){await f(W());return}console.log(s),k("Ocurrió un error al actualizar la labor")}}),X=(s,b)=>{const N={nameWork:s.nameWork,labourType:s.labourType.labourTypeUid,isActive:s.isActive};if(m.current={nameWork:g.nameWork,labourType:g.labourType.uid,isActive:g.isActive},console.log(m.current,N),ie.isEqual(m.current,N)){k("No se han modificado datos");return}const E=b;O.mutate({values:N,id:j},{onSuccess:()=>{E.resetForm({nameWork:"",labourType:{idLabourType:"",code:"",description:""},assignedHours:"",isActive:""})}})};return l?e.jsxs("div",{className:"px-5 py-5",children:[e.jsx(L,{active:!0}),e.jsx("br",{}),e.jsx(L,{active:!0}),e.jsx("br",{}),e.jsx(L,{active:!0})]}):r?e.jsx("p",{children:"Ha ocurrido un error"}):e.jsxs("div",{className:"pt-6 text-center",children:[e.jsxs("div",{className:"flex justify-between px-2 mb-2",children:[e.jsx("h1",{className:"font-semibold pt-1 md:pl-12 text-2xl text-stone-700",children:"Labores"}),e.jsx("button",{className:"  max-w-xs  bg-indigo-500 hover:bg-indigo-700  text-white rounded-lg px-2 py-2 md:mr-20 font-semibold text-sm",onClick:G,children:"Crear nueva"})]}),d&&e.jsx(B,{isModalOpen:d,handleOk:z,handleCancel:F,handleCreateLabourMutation:J,labourMutation:q,labourTypesLoading:o,labourTypesError:u}),x&&e.jsx(Q,{isModalOpen:x,handleOk:_,handleCancel:K,handleUpdateLabourMutation:X,labourUpdateMutation:O,labourTypesLoading:o,labourTypesError:u}),e.jsx("div",{className:"container mx-auto",children:e.jsx(le,{labours:i,setIsEditModalOpen:h})})]})};export{pe as default};
